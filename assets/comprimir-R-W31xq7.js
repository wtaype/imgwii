import{j as f}from"./vendor-gzd0YkcT.js";import{c as Te,N as A,w as Oe}from"./main-BPO2s-bn.js";import"./main-D3W3gWXn.js";import"./firebase-xYuwcABI.js";function me(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);e&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,a)}return t}function k(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?me(Object(t),!0).forEach(function(a){Pe(i,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):me(Object(t)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(t,a))})}return i}function Ie(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function pe(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,we(a.key),a)}}function Fe(i,e,t){return e&&pe(i.prototype,e),t&&pe(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function Pe(i,e,t){return e=we(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function L(){return L=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(i[a]=t[a])}return i},L.apply(this,arguments)}function ze(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var a=t.call(i,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function we(i){var e=ze(i,"string");return typeof e=="symbol"?e:String(e)}var xe={exports:{}};(function(i){typeof window>"u"||(function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,a=e.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),r=a&&e.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,d=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,c=(a||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(s){var l,u,m,y,p,o,w,v,_;if(l=s.match(d),!l)throw new Error("invalid data URI");for(u=l[2]?l[1]:"text/plain"+(l[3]||";charset=US-ASCII"),m=!!l[4],y=s.slice(l[0].length),m?p=atob(y):p=decodeURIComponent(y),o=new ArrayBuffer(p.length),w=new Uint8Array(o),v=0;v<p.length;v+=1)w[v]=p.charCodeAt(v);return a?new Blob([r?w:o],{type:u}):(_=new n,_.append(o),_.getBlob(u))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(s,l,u){var m=this;setTimeout(function(){u&&t.toDataURL&&c?s(c(m.toDataURL(l,u))):s(m.mozGetAsFile("blob",l))})}:t.toDataURL&&c&&(t.msToBlob?t.toBlob=function(s,l,u){var m=this;setTimeout(function(){(l&&l!=="image/png"||u)&&t.toDataURL&&c?s(c(m.toDataURL(l,u))):s(m.msToBlob(l))})}:t.toBlob=function(s,l,u){var m=this;setTimeout(function(){s(c(m.toDataURL(l,u)))})})),i.exports?i.exports=c:e.dataURLtoBlob=c})(window)})(xe);var ve=xe.exports,je=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},ge={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},ke=typeof window<"u"&&typeof window.document<"u",C=ke?window:{},$=function(e){return e>0&&e<1/0},Le=Array.prototype.slice;function V(i){return Array.from?Array.from(i):Le.call(i)}var $e=/^image\/.+$/;function q(i){return $e.test(i)}function Me(i){var e=q(i)?i.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var Ce=String.fromCharCode;function Se(i,e,t){var a="",r;for(t+=e,r=e;r<t;r+=1)a+=Ce(i.getUint8(r));return a}var We=C.btoa;function be(i,e){for(var t=[],a=8192,r=new Uint8Array(i);r.length>0;)t.push(Ce.apply(null,V(r.subarray(0,a)))),r=r.subarray(a);return"data:".concat(e,";base64,").concat(We(t.join("")))}function He(i){var e=new DataView(i),t;try{var a,r,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var d=e.byteLength,c=2;c+1<d;){if(e.getUint8(c)===255&&e.getUint8(c+1)===225){r=c;break}c+=1}if(r){var s=r+4,l=r+10;if(Se(e,s,4)==="Exif"){var u=e.getUint16(l);if(a=u===18761,(a||u===19789)&&e.getUint16(l+2,a)===42){var m=e.getUint32(l+4,a);m>=8&&(n=l+m)}}}if(n){var y=e.getUint16(n,a),p,o;for(o=0;o<y;o+=1)if(p=n+o*12+2,e.getUint16(p,a)===274){p+=8,t=e.getUint16(p,a),e.setUint16(p,1,a);break}}}catch{t=1}return t}function Ne(i){var e=0,t=1,a=1;switch(i){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var Ge=/\.\d*(?:0|9){12}\d*$/;function ye(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Ge.test(i)?Math.round(i*e)/e:i}function P(i){var e=i.aspectRatio,t=i.height,a=i.width,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=$(a),d=$(t);if(n&&d){var c=t*e;(r==="contain"||r==="none")&&c>a||r==="cover"&&c<a?t=a/e:a=t*e}else n?t=a/e:d&&(a=t*e);return{width:a,height:t}}function Xe(i){for(var e=V(new Uint8Array(i)),t=e.length,a=[],r=0;r+3<t;){var n=e[r],d=e[r+1];if(n===255&&d===218)break;if(n===255&&d===216)r+=2;else{var c=e[r+2]*256+e[r+3],s=r+c+2,l=e.slice(r,s);a.push(l),r=s}}return a.reduce(function(u,m){return m[0]===255&&m[1]===225?u.concat(m):u},[])}function qe(i,e){var t=V(new Uint8Array(i));if(t[2]!==255||t[3]!==224)return i;var a=t[4]*256+t[5],r=[255,216].concat(e,t.slice(4+a));return new Uint8Array(r)}var Ze=C.ArrayBuffer,X=C.FileReader,B=C.URL||C.webkitURL,Ve=/\.\w+$/,Ye=C.Compressor,Je=(function(){function i(e,t){Ie(this,i),this.file=e,this.exif=[],this.image=new Image,this.options=k(k({},ge),t),this.aborted=!1,this.result=null,this.init()}return Fe(i,[{key:"init",value:function(){var t=this,a=this.file,r=this.options;if(!je(a)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=a.type;if(!q(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!B||!X){this.fail(new Error("The current browser does not support image compression."));return}Ze||(r.checkOrientation=!1,r.retainExif=!1);var d=n==="image/jpeg",c=d&&r.checkOrientation,s=d&&r.retainExif;if(B&&!c&&!s)this.load({url:B.createObjectURL(a)});else{var l=new X;this.reader=l,l.onload=function(u){var m=u.target,y=m.result,p={},o=1;c&&(o=He(y),o>1&&L(p,Ne(o))),s&&(t.exif=Xe(y)),c||s?!B||o>1?p.url=be(y,n):p.url=B.createObjectURL(a):p.url=y,t.load(p)},l.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},l.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},l.onloadend=function(){t.reader=null},c||s?l.readAsArrayBuffer(a):l.readAsDataURL(a)}}},{key:"load",value:function(t){var a=this,r=this.file,n=this.image;n.onload=function(){a.draw(k(k({},t),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){a.fail(new Error("Aborted to load the image."))},n.onerror=function(){a.fail(new Error("Failed to load the image."))},C.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(C.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=r.name,n.src=t.url}},{key:"draw",value:function(t){var a=this,r=t.naturalWidth,n=t.naturalHeight,d=t.rotate,c=d===void 0?0:d,s=t.scaleX,l=s===void 0?1:s,u=t.scaleY,m=u===void 0?1:u,y=this.file,p=this.image,o=this.options,w=document.createElement("canvas"),v=w.getContext("2d"),_=Math.abs(c)%180===90,S=(o.resize==="contain"||o.resize==="cover")&&$(o.width)&&$(o.height),D=Math.max(o.maxWidth,0)||1/0,U=Math.max(o.maxHeight,0)||1/0,T=Math.max(o.minWidth,0)||0,O=Math.max(o.minHeight,0)||0,E=r/n,g=o.width,b=o.height;if(_){var Y=[U,D];D=Y[0],U=Y[1];var J=[O,T];T=J[0],O=J[1];var K=[b,g];g=K[0],b=K[1]}S&&(E=g/b);var Q=P({aspectRatio:E,width:D,height:U},"contain");D=Q.width,U=Q.height;var ee=P({aspectRatio:E,width:T,height:O},"cover");if(T=ee.width,O=ee.height,S){var te=P({aspectRatio:E,width:g,height:b},o.resize);g=te.width,b=te.height}else{var ie=P({aspectRatio:E,width:g,height:b}),ae=ie.width;g=ae===void 0?r:ae;var re=ie.height;b=re===void 0?n:re}g=Math.floor(ye(Math.min(Math.max(g,T),D))),b=Math.floor(ye(Math.min(Math.max(b,O),U)));var Ee=-g/2,Re=-b/2,De=g,Ue=b,W=[];if(S){var ne=0,oe=0,H=r,N=n,se=P({aspectRatio:E,width:r,height:n},{contain:"cover",cover:"contain"}[o.resize]);H=se.width,N=se.height,ne=(r-H)/2,oe=(n-N)/2,W.push(ne,oe,H,N)}if(W.push(Ee,Re,De,Ue),_){var le=[b,g];g=le[0],b=le[1]}w.width=g,w.height=b,q(o.mimeType)||(o.mimeType=y.type);var ce="transparent";y.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var fe=o.mimeType==="image/jpeg";if(fe&&(ce="#fff"),v.fillStyle=ce,v.fillRect(0,0,g,b),o.beforeDraw&&o.beforeDraw.call(this,v,w),!this.aborted&&(v.save(),v.translate(g/2,b/2),v.rotate(c*Math.PI/180),v.scale(l,m),v.drawImage.apply(v,[p].concat(W)),v.restore(),o.drew&&o.drew.call(this,v,w),!this.aborted)){var de=function(I){if(!a.aborted){var ue=function(F){return a.done({naturalWidth:r,naturalHeight:n,result:F})};if(I&&fe&&o.retainExif&&a.exif&&a.exif.length>0){var he=function(F){return ue(ve(be(qe(F,a.exif),o.mimeType)))};if(I.arrayBuffer)I.arrayBuffer().then(he).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var R=new X;a.reader=R,R.onload=function(G){var F=G.target;he(F.result)},R.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},R.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},R.onloadend=function(){a.reader=null},R.readAsArrayBuffer(I)}}else ue(I)}};w.toBlob?w.toBlob(de,o.mimeType,o.quality):de(ve(w.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(t){var a=t.naturalWidth,r=t.naturalHeight,n=t.result,d=this.file,c=this.image,s=this.options;if(B&&c.src.indexOf("blob:")===0&&B.revokeObjectURL(c.src),n)if(s.strict&&!s.retainExif&&n.size>d.size&&s.mimeType===d.type&&!(s.width>a||s.height>r||s.minWidth>a||s.minHeight>r||s.maxWidth<a||s.maxHeight<r))n=d;else{var l=new Date;n.lastModified=l.getTime(),n.lastModifiedDate=l,n.name=d.name,n.name&&n.type!==d.type&&(n.name=n.name.replace(Ve,Me(n.type)))}else n=d;this.result=n,s.success&&s.success.call(this,n)}},{key:"fail",value:function(t){var a=this.options;if(a.error)a.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=Ye,i}},{key:"setDefaults",value:function(t){L(ge,t)}}]),i})();let h=[],x=null,Be=1;const Ae=i=>{if(!i)return"0 B";const e=1024,t=["B","KB","MB","GB"],a=Math.floor(Math.log(i)/Math.log(e));return`${(i/Math.pow(e,a)).toFixed(1)} ${t[a]}`},lt=()=>`
  <div class="compress_container">
    <div class="comp_layout">
      <div class="comp_left">
        <div class="comp_drop_zone" id="dropZone">
          <div class="drop_placeholder">
            <i class="fas fa-compress-alt"></i>
            <h2>Arrastra tus im√°genes aqu√≠</h2>
            <p>o haz doble clic para seleccionar</p>
            <small>PNG, JPG, WEBP, AVIF (m√°x 50MB)</small>
          </div>
          <input type="file" id="fileInput" accept="image/png,image/jpeg,image/jpg,image/webp,image/avif" multiple hidden>
        </div>
        <div class="comp_preview dpn" id="previewArea">
          <div class="preview_image_container">
            <img id="previewImage" src="" alt="Preview">
          </div>
          <div class="preview_stats dpn" id="previewStats">
            <div class="stats_info">
              <div class="stat_compact"><i class="fas fa-file-alt"></i><span id="statNombre">-</span></div>
              <div class="stat_compact"><i class="fas fa-expand-arrows-alt"></i><span id="statDimensiones">-</span></div>
              <div class="stat_compact"><i class="fas fa-weight-hanging"></i><span id="statTamano">-</span></div>
              <div class="stat_compact quality_input_wrapper">
                <i class="fas fa-star"></i>
                <input type="text" id="qualityInput" value="80">
                <span class="quality_percent">%</span>
              </div>
            </div>
            <div class="stats_controls">
              <button class="btn_stat_control" id="btnCompressCurrent"><i class="fas fa-compress-alt"></i><span>Comprimir</span></button>
              <button class="btn_stat_control" id="btnDownloadCurrent"><i class="fas fa-download"></i><span>Descargar</span></button>
            </div>
          </div>
        </div>
      </div>
      <div class="comp_right">
        <div class="files_section">
          <div class="files_header">
            <h3><i class="fas fa-images"></i> Archivos (<span id="filesCount">0</span>)</h3>
            <button class="btn_clear_all" id="btnClearAll" title="Limpiar todo"><i class="fas fa-trash"></i></button>
          </div>
          <div class="files_list" id="filesList">
            <div class="files_empty"><i class="fas fa-folder-open"></i><p>Sin archivos</p></div>
          </div>
        </div>
      </div>
    </div>
  </div>
`,ct=()=>{console.log(`‚úÖ Compresor de ${Te} cargado`);const i=f("#dropZone");f("#fileInput").on("change",e=>Z(e.target.files)),f("#btnCompressCurrent").on("click",Qe),f("#btnDownloadCurrent").on("click",et),f("#btnClearAll").on("click",_e),i.on("dragover",e=>{e.preventDefault(),i.addClass("dragover")}),i.on("dragleave",e=>{e.preventDefault(),i.removeClass("dragover")}),i.on("drop",e=>{e.preventDefault(),i.removeClass("dragover"),Z(e.originalEvent.dataTransfer.files)}),i.on("dblclick",e=>{e.preventDefault(),f("#fileInput").trigger("click")}),f(document).on("paste",Ke),it()},Ke=i=>{const e=i.originalEvent?.clipboardData?.items;if(!e)return;let t=!1;f.each(e,(a,r)=>{if(r.type.startsWith("image/")){const n=r.getAsFile();if(!n)return!0;const d=new File([n],`Captura_${Be++}.png`,{type:n.type});return Z([d]),t=!0,f("#dropZone, #previewArea").addClass("paste_flash"),setTimeout(()=>{f("#dropZone, #previewArea").removeClass("paste_flash")},300),!1}}),!t&&i.originalEvent?.clipboardData?.items?.length>0&&A("No se detect√≥ imagen en portapapeles","error",2e3)};function Z(i){let e=0;Array.from(i).forEach(t=>{if(!t.type.match("image/(png|jpeg|jpg|webp|avif)"))return A(`${t.name}: formato no soportado`,"error",2e3);if(t.size>50*1024*1024)return A(`${t.name}: muy grande (m√°x 50MB)`,"error",2e3);const a=new FileReader;a.onload=r=>{const n=new Image;n.onload=()=>{h.push({id:Date.now()+Math.random(),file:t,original:{url:r.target.result,size:t.size,width:n.width,height:n.height,name:t.name},isCompressed:!1}),++e===i.length&&(j(),h.length===e&&z(0),A(`${e} archivo(s) agregado(s)`,"success",2e3),M())},n.src=r.target.result},a.readAsDataURL(t)})}function z(i){if(i<0||i>=h.length)return;x=i;const e=h[i];f("#dropZone").is(":visible")&&f("#dropZone").fadeOut(200,()=>f("#previewArea").removeClass("dpn").hide().fadeIn(300)),f("#previewImage").attr("src",e.original.url),f("#previewStats").removeClass("dpn").hide().fadeIn(200),f("#statNombre").text(e.original.name),f("#statDimensiones").text(`${e.original.width}√ó${e.original.height}`),f("#statTamano").text(Ae(e.original.size)),f(".file_item").removeClass("active"),f(`.file_item[data-id="${e.id}"]`).addClass("active")}async function Qe(){if(x===null)return;const i=h[x],e=f("#btnCompressCurrent");e.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> <span>Procesando...</span>');try{const t=parseInt(f("#qualityInput").val())/100,a=performance.now(),r=await new Promise((c,s)=>{new Je(i.file,{quality:t,success:c,error:s})}),n=performance.now(),d=new FileReader;await new Promise(c=>{d.onload=s=>{const l=new Image;l.onload=()=>{const u=((i.original.size-r.size)/i.original.size*100).toFixed(1);h.push({id:Date.now()+Math.random(),file:new File([r],i.original.name,{type:r.type}),original:{url:s.target.result,size:r.size,width:l.width,height:l.height,name:i.original.name},isCompressed:!0,reduccion:u,tiempoCompresion:((n-a)/1e3).toFixed(2)}),j(),z(h.length-1),A(`¬°Comprimida! -${u}%`,"success",2e3),M(),c()},l.src=s.target.result},d.readAsDataURL(r)})}catch(t){console.error("Error:",t),A("Error al comprimir","error")}e.prop("disabled",!1).html('<i class="fas fa-compress-alt"></i> <span>Comprimir</span>')}function et(){if(x===null)return;const i=h[x],e=URL.createObjectURL(i.file),t=document.createElement("a");t.href=e,t.download=i.original.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),Oe("#btnDownloadCurrent","¬°Descargado! üéâ","success",1500)}function _e(){h.length&&(h=[],x=null,Be=1,f("#fileInput").val(""),f("#previewArea").fadeOut(200,()=>f("#dropZone").fadeIn(300)),f("#previewStats").addClass("dpn"),j(),A("Todo limpiado","success",1500),localStorage.removeItem("comprimir_session"))}function j(){f("#filesCount").text(h.length),tt()}function tt(){const i=f("#filesList");if(!h.length)return i.html('<div class="files_empty"><i class="fas fa-folder-open"></i><p>Sin archivos</p></div>');i.html(h.map((e,t)=>{const a=e.reduccion!==void 0,r=a?"fa-check-circle":"fa-image",n=a?"var(--success)":"var(--mco)";return`
      <div class="file_item ${t===x?"active":""} ${a?"compressed":""}" data-id="${e.id}">
        <div class="file_icon"><i class="fas ${r}" style="color: ${n}"></i></div>
        <div class="file_info">
          <span class="file_name">${e.original.name}</span>
          <div class="file_meta">
            <span class="file_size">${Ae(e.original.size)}</span>
            ${a?`<span class="file_reduction">-${e.reduccion}%</span>`:""}
          </div>
        </div>
        <button class="btn_file_delete" data-id="${e.id}"><i class="fas fa-times"></i></button>
      </div>
    `}).join("")),f(".file_item").on("click",function(e){if(f(e.target).closest(".btn_file_delete").length)return;const t=h.findIndex(a=>a.id===f(this).data("id"));t!==-1&&z(t)}),f(".btn_file_delete").on("click",function(e){e.stopPropagation();const t=h.findIndex(a=>a.id===f(this).data("id"));if(t!==-1){if(h.splice(t,1),!h.length)return _e();x>=h.length&&(x=h.length-1),z(x),j(),M()}})}const M=()=>{const i=h.map(e=>({id:e.id,name:e.original.name,url:e.original.url,size:e.original.size,width:e.original.width,height:e.original.height,type:e.type,isCompressed:e.isCompressed,reduccion:e.reduccion}));localStorage.setItem("comprimir_session",JSON.stringify(i))},it=()=>{const i=localStorage.getItem("comprimir_session");if(i)try{const e=JSON.parse(i);if(!e.length||h.length>0)return;e.forEach(t=>{h.push({id:t.id,file:null,original:{url:t.url,name:t.name,size:t.size,width:t.width,height:t.height},type:t.type,isCompressed:t.isCompressed,reduccion:t.reduccion})}),j(),h.length>0&&z(0),console.log(`‚úÖ ${h.length} archivo(s) restaurados`)}catch(e){console.error("Error cargando sesi√≥n:",e)}},ft=()=>{M(),f(document).off("paste")};export{ft as cleanup,ct as init,lt as render};
